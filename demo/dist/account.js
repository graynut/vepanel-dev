define(["vepanel","module","curd"],function(t,e,a){"use strict";a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var i=e.uri.split("?")[0].split("/"),n=i.pop(),r=(i=i.join("/")+(n.endsWith(".js")?"":"/"+n)+"/",{data:function(){return{data:{phone:"",pwd:""},rules:{phone:{required:!0,message:"请输入手机号"},pwd:{required:!0,message:"请输入登录密码"}}}},computed:{link:function(){return this.bag.operate.link}},created:function(){var t=this;if(!this.bag.id||"addson"===this.link)return this.afterInit(),void setTimeout(function(){t.page.init()},500);this.$admin.fetchJson("account/edit",{body:this.dataWithId(),guard:!1,handleError:!1}).then(function(e){e?(t.data=Object.assign({},t.data,e),t.afterInit(),t.page.init()):t.error="未找到要操作的数据"}).catch(function(e){t.page.error(("code"in e?"["+e.code+"]":"")+" "+e.message)})},methods:{dataWithId:function(t){var e={};return e[this.bag.primary]=this.bag.id,e.link=this.link,t=t||{},Object.assign({},t,e)},afterInit:function(){"edit"===this.link&&(this.rules.pwd.required=!1)},save:function(t){var e=this;t.target.blur(),this.$refs.autoForm.validate(function(t){if(!t)return!1;e.postSave()})},postSave:function(){var t=this;this.bag.curd.runAjax("account/save",this.dataWithId(this.data)).then(function(e){e&&("edit"===t.link&&t.bag.row?t.bag.row.phone=t.data.phone:"addson"===t.link&&e.data&&t.addExpandData(e.data,function(e){e.$topid=t.bag.id,e.$s[1]="hide"}),t.page.over())})},addExpandData:function(t,e){if(t&&this.bag.table&&this.bag.curd){var a=this.bag.id,i=this.bag.table.store,n=i.states,r=n.treeData,o=n.lazyTreeNodeMap;r[a].loaded&&(t=(t=this.bag.curd.resolveData([t]))[0],e&&e(t),this.bag.id in o?o[this.bag.id].unshift(t):i.$set(o,a,[t]))}}}}),o=(0,t.n)({render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-form"},[a("el-form",{ref:"autoForm",attrs:{model:t.data,rules:t.rules}},[a("el-form-item",{attrs:{prop:"phone"}},[a("el-input",{attrs:{type:"text","prefix-icon":"el-icon-mobile-phone",placeholder:"手机号",autocomplete:"off"},model:{value:t.data.phone,callback:function(e){t.$set(t.data,"phone",e)},expression:"data.phone"}})],1),a("el-form-item",{attrs:{prop:"pwd"}},[a("el-input",{attrs:{type:"password","prefix-icon":"el-icon-lock",placeholder:"密码",autocomplete:"off"},model:{value:t.data.pwd,callback:function(e){t.$set(t.data,"pwd",e)},expression:"data.pwd"}})],1),a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)],1)},staticRenderFns:[]},void 0,r,void 0,!1,void 0,!1,void 0,void 0,void 0),s={components:{curd:a.curd},created:function(){this.configure={dataSource:"account/list",pagesize:20,multiSort:!0,advanceSearch:{enable:!1},tableProps:{size:"small",stripe:!1,border:!1,fit:!0,"show-header":!0,"highlight-current-row":!1,"row-key":"id","tree-props":{hasChildren:"top",children:"children"},lazy:!0,load:this.expand},tableEvent:{"row-dblclick":function(t,e){console.log(t,e)}},columns:[{field:"phone",name:"手机号",width:180},{field:"security",name:"登录验证",align:"center",width:80,filters:{options:[{text:"开启",value:1},{text:"未开启",value:0}],multiple:!1}},{field:"money",name:"余额",width:90},{field:"name",name:"实名",width:150,flex:1},{field:"join_time",name:"注册时间",width:130,sort:1},{field:"login_time",name:"最后登陆",width:130,sort:1}],revise:[{name:"新增",type:0,link:"add",path:o,after:1}],rowRevise:[{name:"修改",type:1,headerStyle:1,link:"edit",path:o},{name:"新增子账户",type:1,link:"addson",path:o},{name:"禁用",disable:["disable",!0],type:2,link:"account/disable",status:0,after:this.toggleStatus},{name:"启用",disable:["disable",!1],type:2,link:"account/enable",status:1,after:this.toggleStatus},{name:"删除",type:3,callback:this.delete}],operate:[{name:"启用",type:2,link:"account/enable",status:1,after:this.toggleStatus},{name:"禁用",type:2,link:"account/disable",status:0,after:this.toggleStatus}]}},filters:{test:function(t){return t.column.label}},methods:{expand:function(t,e,a){var i=this;this.$admin.postJson("account",{topid:t.id}).then(function(e){var n=i.$refs.curd.resolveData(e.lists);n=n.map(function(e){return e.$topid=t.id,e.$s[1]="hide",e}),a(n)})},toggleStatus:function(t){var e=t.curd,a=(t.id,t.primary,t.row),i=!t.operate.status;(Array.isArray(a)?a:[a]).forEach(function(t){t.disable=i,t.$s[2]=i,t.$s[3]=!i,e.updateRow(t)})},delete:function(t){var e=t.index,a=t.curd,i=t.table,n=t.data,r=t.row,o=t.primary,s=t.id,d=(r.top?"当前账户为主账户，将一并删除其所有子账户，":"")+"确定要删除吗？";this.$admin.confirm(d).then(function(){var t={};return t[o]=s,a.runAjax("account/delete",t)}).then(function(t){if(t){var a=i.store,o=a.states,d=o.treeData,l=o.lazyTreeNodeMap;if(r.top)d[s].loaded&&(delete l[s],delete a.normalizedLazyNode[s],delete d[s]),n.splice(e,1);else{var c=null,u=r.$topid;l[u].some(function(t,e){if(t.id===s)return c=e,!0}),null!==c&&l[u].splice(c,1)}}})},edit:function(t){this.$refs.curd.view({name:"编辑信息",type:1,link:"edit",path:o,id:t.row[t.column],row:t.row,index:t.$index})}}};return(0,t.n)({render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("curd",t._b({ref:"curd",staticClass:"account",scopedSlots:t._u([{key:"column-money-header",fn:function(e){return[a("span",{staticStyle:{color:"red"}},[t._v(t._s(t._f("test")(e)))])]}},{key:"column-phone",fn:function(e){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return a.preventDefault(),t.edit(e)}}},[t._v(t._s(e.row[e.column]))])]}}])},"curd",t.configure,!1),[a("div",{staticStyle:{display:"flex","padding-right":"20px","justify-content":"space-between","align-items":"center"},attrs:{slot:"operate-header"},slot:"operate-header"},[a("span",[t._v("操作")]),a("el-link",{staticStyle:{height:"20px"},attrs:{href:"https://github.com/malacca/vstep/tree/master/src/account.vue",target:"_blank"}},[a("i",{staticClass:"iconfont icon-github"}),t._v("源码")])],1)])},staticRenderFns:[]},void 0,s,void 0,!1,void 0,!1,void 0,void 0,void 0)});